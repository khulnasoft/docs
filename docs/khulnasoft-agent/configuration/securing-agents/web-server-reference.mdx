---
custom_edit_url: "https://github.com/khulnasoft/khulnasoft/edit/master/src/web/server/README.md"
sidebar_label: "Web Server Reference"
docs_status: "Published"
docs_rel_path: "Khulnasoft Agent/Configuration/Securing Agents"
description: "The Khulnasoft Agent's local static-threaded web server serves dashboards and real-time visualizations with security and DDoS protection."
sidebar_position: "408510"
docs_link: "https://docs.khulnasoft.com/docs/khulnasoft-agent/configuration/securing-agents/web-server-reference"
---

# Web Server

The Khulnasoft Web Server is `static-threaded`, with a fixed, configurable number of threads.

All the threads are concurrently listening for web requests on the same sockets, and the kernel distributes the incoming requests to them. Each thread uses non-blocking I/O so it can serve any number of web requests in parallel.

It respects the `keep-alive` HTTP header to serve multiple HTTP requests via the same connection.

## Configuration

Edit `khulnasoft.conf` using the [`edit-config` script](/docs/khulnasoft-agent/configuration#edit-a-configuration-file-using-edit-config)

Scroll down to the `[web]` section to find the following settings.

## Settings

| Setting                            | Default                                                                                                                                                                                | Description                                                                                                                                                                                                                                                                                                                                                                                              |
|:-----------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `ssl key`                          | `/etc/khulnasoft/ssl/key.pem`                                                                                                                                                             | Declare the location of an SSL key to enable HTTPS.                                                                                                                                                                                                                                                                                                                                                      |
| `ssl certificate`                  | `/etc/khulnasoft/ssl/cert.pem`                                                                                                                                                            | Declare the location of an SSL certificate to enable HTTPS.                                                                                                                                                                                                                                                                                                                                              |
| `tls version`                      | `1.3`                                                                                                                                                                                  | Choose which TLS version to use. While all versions are allowed (`1` or `1.0`, `1.1`, `1.2` and `1.3`), we recommend `1.3` for the most secure encryption. If left blank, Khulnasoft uses the highest available protocol version on your system.                                                                                                                                                            |
| `tls ciphers`                      | `none`                                                                                                                                                                                 | Choose which TLS cipher to use. Options include `TLS_AES_256_GCM_SHA384`, `TLS_CHACHA20_POLY1305_SHA256`, and `TLS_AES_128_GCM_SHA256`. If left blank, Khulnasoft uses the default cipher list for that protocol provided by your TLS implementation.                                                                                                                                                       |
| `ses max window`                   | `15`                                                                                                                                                                                   | See [single exponential smoothing](/docs/developer-and-contributor-corner/rest-api/queries/single-or-simple-exponential-smoothing-ses).                                                                                                                                                                                                                                                                                                                                  |
| `des max window`                   | `15`                                                                                                                                                                                   | See [double exponential smoothing](/docs/developer-and-contributor-corner/rest-api/queries/double-exponential-smoothing).                                                                                                                                                                                                                                                                                                                                  |
| `mode`                             | `static-threaded`                                                                                                                                                                      | Turns on (`static-threaded`) or off (`none`) the static-threaded Web Server. See the [example](#disable-the-web-server) to turn off the Web Server and disable the dashboard.                                                                                                                                                                                                                            |
| `listen backlog`                   | `4096`                                                                                                                                                                                 | The port backlog. Check `man 2 listen`.                                                                                                                                                                                                                                                                                                                                                                  |
| `default port`                     | `19999`                                                                                                                                                                                | The listen port for the static Web Server.                                                                                                                                                                                                                                                                                                                                                               |
| `web files owner`                  | `khulnasoft`                                                                                                                                                                              | The user that owns the web static files. Khulnasoft will refuse to serve a file that is not owned by this user, even if it has read access to that file. If the user given is not found, Khulnasoft will only serve files owned by user given in `run as user`.                                                                                                                                                |
| `web files group`                  | `khulnasoft`                                                                                                                                                                              | If this is set, Khulnasoft will check if the file is owned by this group and refuse to serve the file if it's not.                                                                                                                                                                                                                                                                                          |
| `disconnect idle clients after`    | `1m`                                                                                                                                                                                   | The time in seconds to disconnect web clients after being totally idle.                                                                                                                                                                                                                                                                                                                                  |
| `timeout for first request`        | `1m`                                                                                                                                                                                   | How long to wait for a client to send a request before closing the socket. Prevents slow request attacks.                                                                                                                                                                                                                                                                                                |
| `accept a streaming request every` | `off`                                                                                                                                                                                  | Can be used to set a limit on how often a Parent will accept streaming requests from Children in a [streaming and replication setup](/docs/observability-centralization-points/streaming-and-replication-reference).                                                                                                                                                                                                                                          |
| `respect do not track policy`      | `no`                                                                                                                                                                                   | If set to `yes`, Khulnasoft will respect the user's browser preferences for [Do Not Track](https://www.eff.org/issues/do-not-track) (DNT) and storing cookies. If DNT is _enabled_ in the browser, and this option is set to `yes`, nodes will not connect to any [registry](/docs/khulnasoft-agent/registry). For certain browsers, users must disable DNT and change this option to `yes` for full functionality. |
| `x-frame-options response header`  | ``                                                                                                                                                                                     | Avoid [clickjacking attacks](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options), by ensuring that the content is not embedded into other sites.                                                                                                                                                                                                                                  |
| `allow connections from`           | `localhost *`                                                                                                                                                                          | Declare which IP addresses or full-qualified domain names (FQDNs) are allowed to connect to the Web Server, including the [dashboard](/docs/dashboards-and-charts) or [HTTP API](/docs/developer-and-contributor-corner/rest-api). This is a global setting with higher priority to any of the ones below.                                                                                                              |
| `allow connections by dns`         | `heuristic`                                                                                                                                                                            | See the [access list section](#access-lists) for details on using `allow` settings.                                                                                                                                                                                                                                                                                                                      |
| `allow dashboard from`             | `localhost *`                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                          |
| `allow dashboard by dns`           | `heuristic`                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                          |
| `allow badges from`                | `*`                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                          |
| `allow badges by dns`              | `heuristic`                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                          |
| `allow streaming from`             | `*`                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                          |
| `allow streaming by dns`           | `heuristic`                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                          |
| `allow khulnasoft.conf`               | `localhost fd* 10.* 192.168.* 172.16.* 172.17.* 172.18.* 172.19.* 172.20.* 172.21.* 172.22.* 172.23.* 172.24.* 172.25.* 172.26.* 172.27.* 172.28.* 172.29.* 172.30.* 172.31.* UNKNOWN` |                                                                                                                                                                                                                                                                                                                                                                                                          |
| `allow khulnasoft.conf by dns`        | `no`                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                          |
| `allow management from`            | `localhost`                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                          |
| `allow management by dns`          | `heuristic`                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                          |
| `enable gzip compression`          | `yes`                                                                                                                                                                                  | When set to `yes`, Khulnasoft web responses will be GZIP compressed, if the web client accepts such responses.                                                                                                                                                                                                                                                                                              |
| `gzip compression strategy`        | `default`                                                                                                                                                                              | Valid settings are `default`, `filtered`, `huffman only`, `rle` and `fixed`.                                                                                                                                                                                                                                                                                                                             |
| `gzip compression level`           | `3`                                                                                                                                                                                    | Valid settings are 1 (fastest) to 9 (best ratio).                                                                                                                                                                                                                                                                                                                                                        |
| `web server threads`               | ``                                                                                                                                                                                     | How many processor threads the web server is allowed. The default is system-specific, the minimum of `6` or the number of CPU cores.                                                                                                                                                                                                                                                                     |
| `web server max sockets`           | ``                                                                                                                                                                                     | Available sockets. The default is system-specific, automatically adjusted to 50% of the max number of open files Khulnasoft is allowed to use (via `/etc/security/limits.conf` or systemd), to allow enough file descriptors to be available for data collection.                                                                                                                                           |
| `custom dashboard_info.js`         | ``                                                                                                                                                                                     | Specifies the location of a custom `dashboard.js` file. See [customizing the standard dashboard](/docs/developer-and-contributor-corner/customize-the-standard-dashboard#customize-the-standard-dashboard) for details.                                                                                                                                                                                                      |

## Access lists

Khulnasoft supports access lists in `khulnasoft.conf`:

```text
[web]
    allow connections from = localhost *
    allow dashboard from = localhost *
    allow badges from = *
    allow streaming from = *
    allow khulnasoft.conf from = localhost fd* 10.* 192.168.* 172.16.* 172.17.* 172.18.* 172.19.* 172.20.* 172.21.* 172.22.* 172.23.* 172.24.* 172.25.* 172.26.* 172.27.* 172.28.* 172.29.* 172.30.* 172.31.*
    allow management from = localhost
```

`*` does string matches on the IPs or FQDNs of the clients.

- `allow connections from` matches anyone that connects on the Khulnasoft port(s).
  So, if someone is not allowed, it will be connected and disconnected immediately, without reading even
  a single byte from its connection. This is a global setting with higher priority to any of the ones below.

- `allow dashboard from` receives the request and examines if it is a static dashboard file or an API call the
  dashboards do.

- `allow badges from` checks if the API request is for a badge. Badges aren’t matched by `allow dashboard from`.

- `allow streaming from` checks if the child willing to stream metrics to this Khulnasoft is allowed.
  This can be controlled per API KEY and MACHINE GUID in `stream.conf`.
  The setting in `khulnasoft.conf` is checked before the ones in `stream.conf`.

- `allow khulnasoft.conf from` checks the IP to allow `http://khulnasoft.host:19999/khulnasoft.conf`.
  The IPs listed are all the private IPv4 addresses, including link-local IPv6 addresses. Keep in mind that connections to Khulnasoft API ports are filtered by `allow connections from`. So, IPs allowed by `allow khulnasoft.conf from` should also be allowed by `allow connections from`.

- `allow management from` checks the IPs to allow API management calls. Management via the API is currently supported for [health](/docs/alerts-&-notifications/health-api-calls#health-management-api)

To check the FQDN of the connection without opening the Khulnasoft Agent to DNS-spoofing, a reverse-dns record must be setup for the connecting host. At connection time, the reverse-dns of the peer IP address is resolved, and a forward DNS resolution is made to validate the IP address against the name-pattern.

Please note that this process can be expensive on a machine that is serving many connections. Each access list has an associated configuration option to turn off DNS-based patterns completely to avoid incurring this cost at run-time:

```text
    allow connections by dns = heuristic
    allow dashboard by dns = heuristic
    allow badges by dns = heuristic
    allow streaming by dns = heuristic
    allow khulnasoft.conf by dns = no
    allow management by dns = heuristic
```

The three possible values for each of these options are `yes`, `no` and `heuristic`. The `heuristic` option disables the check when the pattern only contains IPv4/IPv6 addresses or `localhost`, and enables it when wildcards are present that may match DNS FQDNs.

## DDoS protection

If you publish your Khulnasoft web server to the internet, you may want to apply some protection against DDoS:

1. Use the `static-threaded` web server (it is the default)
2. Use reasonable `[web].web server max sockets` (e.g default)
3. Don't use all your CPU cores for Khulnasoft (lower `[web].web server threads`)
4. Run the `khulnasoft` process with a low process scheduling priority (the default is the lowest)
5. If possible, proxy Khulnasoft via a full-featured web server (Nginx, Apache, etc.)

## Examples

### Disable the Web Server

<details><summary>details</summary>

Edit `khulnasoft.conf` using the [`edit-config` script](/docs/khulnasoft-agent/configuration#edit-a-configuration-file-using-edit-config)

```text
[web]
    mode = none
```

</details>

### Change the number of threads

<details><summary>details</summary>

Control the number of threads and sockets with the following settings:

```text
[web]
    web server threads = 4
    web server max sockets = 512
```

</details>

### Binding Khulnasoft to multiple ports

<details><summary>details</summary>

Khulnasoft can bind to multiple IPs and ports, offering access to different services on each. Up to 100 sockets can be used (increase it at compile time with `CFLAGS="-DMAX_LISTEN_FDS=200" ./khulnasoft-installer.sh ...`).

The ports to bind are controlled via `[web].bind to`, like this:

```text
[web]
   default port = 19999
   bind to = 127.0.0.1=dashboard^SSL=optional 10.1.1.1:19998=management|khulnasoft.conf hostname:19997=badges [::]:19996=streaming^SSL=force localhost:19995=registry *:http=dashboard unix:/run/khulnasoft/khulnasoft.sock
```

Using the above, Khulnasoft will bind to:

- IPv4 127.0.0.1 at port 19999 (port was used from `default port`). Only the UI (dashboard) and the read API will be accessible on this port. Both HTTP and HTTPS requests will be accepted.
- IPv4 10.1.1.1 at port 19998. The management API and `khulnasoft.conf` will be accessible on this port.
- All the IPs `hostname` resolves to (both IPv4 and IPv6 depending on the resolved IPs) at port 19997. Only badges will be accessible on this port.
- All IPv6 IPs at port 19996. Only metric streaming requests from other Khulnasoft Agents will be accepted on this port. Only encrypted streams will be allowed (i.e., Children also need to be [configured for TLS](/docs/observability-centralization-points/streaming-and-replication-reference)).
- All the IPs `localhost` resolves to (both IPv4 and IPv6 depending on the resolved IPs) at port 19996. This port will only accept registry API requests.
- All IPv4 and IPv6 IPs at port `http` as set in `/etc/services`. Only the UI (dashboard) and the read API will be accessible on this port.
- Unix domain socket `/run/khulnasoft/khulnasoft.sock`. All requests are serviceable on this socket. Note that in some OSs like Fedora, every service sees a different `/tmp`, so don't create a Unix socket under `/tmp`. `/run` or `/var/run` is suggested.

The option `[web].default port` is used when entries in `[web].bind to` do not specify a port.

As shown in the example above, these permissions are optional, with the default permitting all request types on the specified port.

The request types are strings identical to the `allow X from` directives of the access lists, i.e. `dashboard`, `streaming`, `registry`, `khulnasoft.conf`, `badges` and `management`.
The access lists themselves and the general setting `allow connections from` in the next section are applied regardless of the ports that are configured to provide these services.

The API requests are serviced as follows:

- `dashboard` gives access to the UI, the read API and badges API calls.
- `badges` gives access only to the badge API calls.
- `management` gives access only to the management API calls.

</details>

### Enable HTTPS/TLS support

<details><summary>details</summary>

Since v1.16.0, Khulnasoft supports encrypted HTTP connections to the web server, plus encryption of streaming data to a
parent from its child nodes, via the TLS protocol.

Inbound unix socket connections are unaffected, regardless of the TLS settings.

> While Khulnasoft uses Transport Layer Security (TLS) 1.2 to encrypt communications rather than the obsolete SSL protocol,
> it's still common practice to refer to encrypted web connections as `SSL`. Many vendors, like Nginx and even Khulnasoft
> itself, use `SSL` in configuration files, whereas documentation will always refer to encrypted communications as `TLS`
> or `TLS/SSL`.

To enable TLS, provide the path to your certificate and private key in the `[web]` section of `khulnasoft.conf`:

```text
[web]
    ssl key = /etc/khulnasoft/ssl/key.pem
    ssl certificate = /etc/khulnasoft/ssl/cert.pem
```

Both files must be readable by the `khulnasoft` user. If any of these files are missing or can’t be read, Khulnasoft will fall back to using HTTP. For a parent-child connection, only the parent needs these settings.

For test purposes, generate self-signed certificates with the following command:

```bash
openssl req -newkey rsa:2048 -nodes -sha512 -x509 -days 365 -keyout key.pem -out cert.pem
```

> If you use 4096 bits for your key and the certificate, Khulnasoft will need more CPU to process the communication.
> `rsa4096` can be up to four times slower than `rsa2048`, so we recommend using 2048 bits. Verify the difference
> by running:
>
> ```sh
> openssl speed rsa2048 rsa4096
> ```

</details>

### Select TLS version

<details><summary>details</summary>

Beginning with version `v1.21.0`, specify the TLS version and the ciphers that you want to use:

```text
[web]
    tls version = 1.3
    tls ciphers = TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256
```

If you don’t specify these options, Khulnasoft will use the highest available protocol version on your system and the default cipher list for that protocol provided by your TLS implementation.

#### TLS/SSL enforcement

When the certificates are defined and unless any other options are provided, a Khulnasoft server will:

- Redirect all incoming HTTP web server requests to HTTPS. Applies to the dashboard, the API, `khulnasoft.conf` and badges.
- Allow incoming child connections to use both unencrypted and encrypted communications for streaming.

To change this behavior, you need to modify the `bind to` setting in the `[web]` section of `khulnasoft.conf`. At the end of each port definition, append `^SSL=force` or `^SSL=optional`. What happens with these settings differs, depending on whether the port is used for HTTP/S requests or for streaming.

| SSL setting |    HTTP requests    | HTTPS requests | Unencrypted Streams | Encrypted Streams |
|:-----------:|:-------------------:|:--------------:|:-------------------:|:------------------|
|    none     | Redirected to HTTPS |    Accepted    |      Accepted       | Accepted          |
|   `force`   | Redirected to HTTPS |    Accepted    |       Denied        | Accepted          |
| `optional`  |      Accepted       |    Accepted    |      Accepted       | Accepted          |

Example:

```text
[web]
    bind to = *=dashboard|registry|badges|management|streaming|khulnasoft.conf^SSL=force
```

For information how to configure the child to use TLS, check [securing the communication](/docs/observability-centralization-points/streaming-and-replication-reference#securing-streaming-with-tlsssl) in the streaming documentation. There you will find additional details on the expected behavior for client and server nodes, when their respective TLS options are enabled.

When we define the use of SSL in a Khulnasoft Agent for different ports, Khulnasoft will apply the behavior specified on each port. For example, using the configuration line below:

```text
[web]
    bind to = *=dashboard|registry|badges|management|streaming|khulnasoft.conf^SSL=force *:20000=khulnasoft.conf^SSL=optional *:20001=dashboard|registry
```

Khulnasoft will:

- Force all HTTP requests to the default port to be redirected to HTTPS (same port).
- Refuse unencrypted streaming connections from child nodes on the default port.
- Allow both HTTP and HTTPS requests to port 20000 for `khulnasoft.conf`
- Force HTTP requests to port 20001 to be redirected to HTTPS (same port). Only allow requests for the dashboard, the read API and the Registry on port 20001.

#### TLS/SSL errors

When you start using Khulnasoft with TLS, you may find errors in the Khulnasoft log, which is stored at `/var/log/khulnasoft/error.log` by default.

Most of the time, these errors are due to incompatibilities between your browser's options related to TLS/SSL protocols and Khulnasoft's internal configuration. The most common error is `error:00000006:lib(0):func(0):EVP lib`.

</details>
